name: Windows

on: [pull_request]

jobs:
  Test:
    strategy:
      matrix:
        version: ['2016', '2019']
    runs-on: windows-${{ matrix.version }}

    steps:
      - name: Prep OS
        run: |
          choco install python --version 3.8.0

      - uses: actions/checkout@v2

      - name: Install Salt
        run: |
          Invoke-WebRequest -Uri https://winbootstrap.saltproject.io -OutFile C:\Temp\bootstrap-salt.ps1
          Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope CurrentUser
          C:\Temp\bootstrap-salt.ps1 -runservice false
          Set-ExecutionPolicy -ExecutionPolicy Undefined -Scope CurrentUser

      # FIXME move this to a testing tool
      - name: Run Tests
        run: |
          salt-call -l debug --local -c .salttest state.show_sls alertlogic.user
          salt-call -l debug --local -c .salttest state.show_sls alertlogic.agent
